<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë§›ë™ì‚°</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#101827;
      --panel2:#0f172a;
      --border:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --accent:#6366f1;
      --accent2:#8b5cf6;
      --max:1200px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic", Arial, sans-serif;
    }
    a{color:inherit; text-decoration:none}
    .topbar{
      position:sticky; top:0; z-index:50;
      background:rgba(11,15,23,.82); backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border);
    }
    .topbar-inner{max-width:var(--max); margin:0 auto; padding:14px 18px; display:flex; gap:12px; align-items:center; justify-content:space-between;}
    .brand{display:flex; flex-direction:column; gap:2px;}
    .brand .t{font-weight:900; letter-spacing:.2px}
    .brand .s{font-size:12px; color:var(--muted)}
    .tabs{display:flex; gap:8px; align-items:center;}
    .tab{
      padding:9px 14px; border-radius:999px; border:1px solid var(--border);
      background:rgba(255,255,255,.04); cursor:pointer; user-select:none;
      font-size:13px; font-weight:800; color:rgba(255,255,255,.88);
      transition: transform .2s ease, background .2s ease, border-color .2s ease, opacity .2s ease;
    }
    .tab:hover{background:rgba(255,255,255,.06)}
    .tab.active{background:rgba(99,102,241,.22); border-color:rgba(99,102,241,.45);}
    .wrap{max-width:var(--max); margin:0 auto; padding:18px;}
    .layout{display:grid; grid-template-columns:320px 1fr; gap:16px; align-items:start;}
    .card{border:1px solid var(--border); background:rgba(255,255,255,.04); border-radius:18px; overflow:hidden; box-shadow:0 14px 40px rgba(0,0,0,.25);}
    .card-head{padding:14px 16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; gap:10px; align-items:flex-start;}
    .h{font-weight:900}
    .s{font-size:12px; color:var(--muted); margin-top:4px;}
    .body{padding:14px 16px;}
    .input{
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--border);
      background:rgba(255,255,255,.04); color:var(--text); outline:none;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .badge{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); color:rgba(255,255,255,.82); background:rgba(255,255,255,.03);}
    .nav-list{display:flex; flex-direction:column;}
    .nav-item{display:flex; gap:10px; padding:10px 12px; border-top:1px solid var(--border); align-items:center; cursor:pointer;}
    .nav-item:hover{background:rgba(255,255,255,.03)}
    .nav-item.active{background:rgba(99,102,241,.12);}
    .thumb{width:34px; height:34px; border-radius:10px; border:1px solid var(--border); background:rgba(255,255,255,.04); overflow:hidden; flex:0 0 auto;}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block;}
    .meta .name{font-weight:900; font-size:13px}
    .meta .cat{font-size:12px; color:var(--muted); margin-top:2px}
    .grid{display:grid; gap:10px;}
    .table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border:1px solid var(--border); border-radius:14px;}
    .table th,.table td{padding:10px 10px; border-bottom:1px solid var(--border); font-size:13px; text-align:left;}
    .table th{color:rgba(255,255,255,.85); background:rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:none}
    .muted{color:var(--muted)}
    .calc-mode body{}
    .calc-only{display:none;}
    body.calc-mode{background: radial-gradient(1200px 600px at 50% -10%, #1e1b4b 0%, #0b0f17 60%) fixed; transition: background .5s ease;}
    body.calc-mode .wiki-only{display:none;}
    body.calc-mode .calc-only{display:block;}
    .fade-in{animation:fadeInUp .28s ease both;}
    @keyframes fadeInUp{from{opacity:0; transform:translateY(10px)}to{opacity:1; transform:translateY(0)}}
    @media (max-width: 900px){ .layout{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="t" id="pageTitle">ë§›ë™ì‚°</div>
        <div class="s" id="pageSub">  </div>
      </div>
      <div class="tabs">
        <div class="tab active" id="tabWiki">í•­í•´ ìœ„í‚¤</div>
        <div class="tab" id="tabCalc">ê³¨ë“œ ê³„ì‚°ê¸°</div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- WIKI -->
    <div class="wiki-only">
      <div class="layout">
        <aside class="card">
          <div class="card-head">
            <div>
              <div class="h">ëª©ì°¨</div>
              <div class="s muted">ê²€ìƒ‰/í•„í„° â†’ ëª©ë¡ì— ì ìš©</div>
            </div>
            <span class="badge" id="countBadge">0</span>
          </div>
          <div class="body grid" style="gap:10px;">
            <input id="q" class="input" placeholder="ê²€ìƒ‰: ë¼ë¹„ì˜¨, ì¼€ë¡œì•„..." />
            
          </div>
          <div class="nav-list" id="nav"></div>
        </aside>

        <main class="grid">
          <section class="card fade-in" id="contentCard">
            <div class="card-head">
              <div>
                <div class="h" id="contentTitle">ì„ íƒ ëŒ€ê¸°</div>
                <div class="s" id="contentMeta">ì™¼ìª½ ëª©ì°¨ì—ì„œ í•­ëª©ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
              </div>
              <div class="row">
                <span class="badge">ì—…ë°ì´íŠ¸: 2026-02-14</span>
              </div>
            </div>
            <div class="body" id="contentBody">
              <div class="muted">ë°ì´í„°ëŠ” <code>data/manifest.json</code> + ê°œë³„ JSONë¡œ ë¡œë“œë©ë‹ˆë‹¤.</div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <!-- CALC -->
    <div class="calc-only">
      <section class="card fade-in" style="max-width:720px;margin:0 auto;">
        <div class="card-head">
          <div>
            <div class="h">ğŸ’° ê³¨ë“œ ë³´ë‚´ê¸° ê³„ì‚°ê¸°</div>
            <div class="s muted">ì…ë ¥ ì¦‰ì‹œ ìˆ˜ìˆ˜ë£Œ 5% ìë™ ê³„ì‚°</div>
          </div>
          <span class="badge">ìˆ˜ìˆ˜ë£Œ 5%</span>
        </div>
        <div class="body" style="max-width:520px;">
          <label class="muted">ë³´ë‚¼ ê³¨ë“œ</label>
          <input type="number" id="goldInput" class="input" placeholder="ì˜ˆ: 100000" inputmode="numeric" />
          <div style="margin-top:16px;">
            <div>ìˆ˜ìˆ˜ë£Œ(5%) : <b id="feeAmount" style="color:#f87171;">0</b></div>
            <div style="margin-top:8px;font-size:18px;font-weight:900;">ë°›ëŠ” ê³¨ë“œ : <b id="finalAmount" style="color:#34d399;">0</b></div>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
  // --- helpers
  const ROOT = new URL('./', window.location.href);
  const urlJoin = (p) => new URL(p, ROOT).toString();
  const esc = (s) => String(s).replace(/[&<>"']/g, c => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"})[c]);

  // --- UI elements
  const tabWiki = document.getElementById('tabWiki');
  const tabCalc = document.getElementById('tabCalc');

  const navEl = document.getElementById('nav');
  const qEl = document.getElementById('q');
  
  const countBadge = document.getElementById('countBadge');

  const contentTitle = document.getElementById('contentTitle');
  const contentMeta = document.getElementById('contentMeta');
  const contentBody = document.getElementById('contentBody');

  let MANIFEST = null;
  let selectedId = null;
  let query = '';
  let groupFilter = 'all';

  function setMode(mode){
    if(mode === 'calc'){
      document.body.classList.add('calc-mode');
      tabCalc.classList.add('active');
      tabWiki.classList.remove('active');
      window.scrollTo({top:0,behavior:'smooth'});
    } else {
      document.body.classList.remove('calc-mode');
      tabWiki.classList.add('active');
      tabCalc.classList.remove('active');
      window.scrollTo({top:0,behavior:'smooth'});
    }
  }
  tabWiki.onclick = () => setMode('wiki');
  tabCalc.onclick = () => setMode('calc');

  // calculator
  document.getElementById('goldInput').addEventListener('input', function(){
    const gold = parseFloat(this.value);
    if(!Number.isFinite(gold) || gold <= 0){
      document.getElementById('feeAmount').textContent = '0';
      document.getElementById('finalAmount').textContent = '0';
      return;
    }
    const fee = gold * 0.05;
    const finalGold = gold - fee;
    document.getElementById('feeAmount').textContent = fee.toLocaleString();
    document.getElementById('finalAmount').textContent = finalGold.toLocaleString();
  });

  function matches(loc){
    const hay = ((loc.name||'') + ' ' + (loc.group||'')).toLowerCase();
    const q = query.trim().toLowerCase();
    const okQ = !q || hay.includes(q);
    return okQ;
  }

  function renderNav(){
    const list = (MANIFEST.locations||[]).filter(matches);
    countBadge.textContent = String(list.length);
    navEl.innerHTML = list.map(loc => {
      const active = (loc.id === selectedId) ? 'active' : '';
      const thumb = loc.icon ? `<img src="${esc(loc.icon)}" alt="" loading="lazy">` : '';
      return `
        <div class="nav-item ${active}" data-id="${esc(loc.id)}" data-file="${esc(loc.file)}">
          <div class="thumb">${thumb}</div>
          <div class="meta">
            <div class="name">${esc(loc.name)}</div>
            <div class="cat">${esc(loc.group)} Â· ${esc(loc.points)}P Â· ${esc(loc.time)}</div>
          </div>
        </div>
      `;
    }).join('') || `<div style="padding:12px;color:${esc('rgba(255,255,255,.7)')}">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”.</div>`;

    Array.from(navEl.querySelectorAll('.nav-item')).forEach(el => {
      el.addEventListener('click', async () => {
        const id = el.dataset.id;
        const file = el.dataset.file;
        await loadIsland(id, file);
        renderNav();
      });
    });
  }

  
  async function loadIsland(id, file){
    selectedId = id;
    try {
      const res = await fetch(urlJoin('data/' + file) + '?v=' + Date.now(), { cache:'no-store' });
      if(!res.ok) throw new Error('ì„¬ JSON HTTP ' + res.status);
      const j = await res.json();
      const loc = j.location || (j.locations||[])[0];
      if(!loc) throw new Error('location ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ');

      contentTitle.textContent = loc.name + ' ë³´ìƒí‘œ';
      contentMeta.textContent = `${loc.group} Â· ${loc.points}P Â· ${loc.time}`;

      // rewards table
      const rewards = loc.rewards || [];
      let table = '<div class="muted">ë³´ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
      if(rewards.length){
        const headers = Object.keys(rewards[0]);
        table = `
          <table class="table">
            <thead><tr>${headers.map(h=>`<th>${esc(h)}</th>`).join('')}</tr></thead>
            <tbody>
              ${rewards.map(r => `<tr>${headers.map(h => `<td>${esc(r[h])}</td>`).join('')}</tr>`).join('')}
            </tbody>
          </table>
        `;
      }
      contentBody.innerHTML = `
        <div class="row" style="margin-bottom:10px;">
          <span class="badge">id: ${esc(loc.id)}</span>
          <span class="badge">ê·¸ë£¹: ${esc(loc.group)}</span>
        </div>
        ${table}
      `;
    } catch (err) {
      contentTitle.textContent = 'ë¡œë“œ ì‹¤íŒ¨';
      contentMeta.textContent = '';
      contentBody.innerHTML = `<div class="muted">ì—ëŸ¬: ${esc(err.message || err)}</div>
        <div class="muted" style="margin-top:8px;">í™•ì¸: <code>${esc(urlJoin('data/' + file))}</code></div>`;
    }
  }

  async function boot(){
    try {
      const res = await fetch(urlJoin('data/manifest.json') + '?v=' + Date.now(), { cache:'no-store' });
      if(!res.ok) throw new Error('manifest HTTP ' + res.status);
      MANIFEST = await res.json();

      // page title/sub
      document.getElementById('pageTitle').textContent = MANIFEST.meta?.title || 'ë§›ë™ì‚°';
      document.getElementById('pageSub').textContent = MANIFEST.meta?.notes || 'ëª©ì°¨ì—ì„œ í•­ëª© ì„ íƒ â†’ í•´ë‹¹ JSON ë¡œë“œ';

      
      renderNav();

      // wire search/filter
      qEl.addEventListener('input', () => { query = qEl.value; renderNav(); });
      
      // auto-open first item
      const first = (MANIFEST.locations||[])[0];
      if(first) {
        await loadIsland(first.id, first.file);
        renderNav();
      }
    } catch (err) {
      contentTitle.textContent = 'manifest ë¡œë“œ ì‹¤íŒ¨';
      contentBody.innerHTML = `
        <div class="muted">ì—ëŸ¬: ${esc(err.message || err)}</div>
        <div class="muted" style="margin-top:8px;">í™•ì¸ URL:</div>
        <ul style="margin:6px 0 0 18px; color:rgba(255,255,255,.82)">
          <li><code>${esc(urlJoin('data/manifest.json'))}</code></li>
        </ul>
      `;
    }
  }
  boot();
</script>
</body>
</html>
